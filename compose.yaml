x-environment:
  &x-environment
  INITIAL: "${INITIAL:-0}"

services:
  web:
    build:
      context: .
      target: build
    extra_hosts:
      - host.docker.internal:host-gateway

    command: gunicorn myapp.wsgi:application -w 2 -b :8000
    ports:
      - "8000:8000"
    volumes:
      - venv:/venv
      - .:/code
    environment:
      <<: *x-environment
      ALLOWED_HOSTS: >-
        localhost
      DATABASE_URL: postgresql://postgres@db/hello-db
    stdin_open: true
    tty: true
#  redis:
#    image: redis:latest
#    ports:
#      - "6379:6379"
#    volumes:
#      - redisdata:/data
volumes:
  pgdata:
  venv:
